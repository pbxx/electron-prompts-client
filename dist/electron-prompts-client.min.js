(()=>{"use strict";const e={inputHTMLType:{onChange:["number","radio","checkbox","range","file","date","datetime-local","time","week","month","color"],restrictedAttributes:["id","onchange","onkeyup"]}},t=new class{adoptedPrompt=null;devMode=!1;formStateDefaults={};formState={};constructor(){}init=async()=>{const t={ebox:document.getElementById("epc-elembox"),bbox:document.getElementById("epc-buttonbox"),titleText:document.getElementById("epc-titletext")};if(this.adoptedPrompt=await window.electronAPI.adopt(),this.adoptedPrompt){this.adoptedPrompt.devMode&&(this.devMode=!0),this.logs.log(this.adoptedPrompt,this.adoptedPrompt.windowTitle),t.titleText.innerHTML=this.adoptedPrompt.windowTitle,document.title=this.adoptedPrompt.windowTitle,this.adoptedPrompt.elements.forEach((a=>{switch(a.type){case"header":(o=t.ebox.appendChild(document.createElement("h4"))).innerHTML=a.value,a.classes&&a.classes.forEach((e=>{o.classList.add(e)}));break;case"paragraph":(o=t.ebox.appendChild(document.createElement("p"))).innerHTML=a.value,a.classes&&a.classes.forEach((e=>{o.classList.add(e)}));break;case"input":var o=t.ebox.appendChild(document.createElement("input")),s="keyup";this.formStateDefaults[a.name]=void 0===a.value?"":a.value,console.log(a),"attributes"in a&&("type"in a.attributes&&e.inputHTMLType.onChange.includes(a.attributes.type)&&(s="change"),Object.keys(a.attributes).forEach((t=>{e.inputHTMLType.restrictedAttributes.includes(t)||(!0===a.attributes[t]?o.setAttribute(t,""):o.setAttribute(t,a.attributes[t]))}))),"classes"in a&&a.classes.forEach((e=>{o.classList.add(e)})),"placeholder"in a&&o.setAttribute("placeholder",a.placeholder),"value"in a&&(o.value=a.value),o.setAttribute("id",`form-${a.name}`),"attributes"in a&&"type"in a.attributes&&"file"==a.attributes.type?o.addEventListener(a.updateEvent||s,this.updateFormStateFile(a.name)):o.addEventListener(a.updateEvent||s,this.updateFormState(a.name));break;case"select":if(o=t.ebox.appendChild(document.createElement("select")),a.classes&&a.classes.forEach((e=>{o.classList.add(e)})),console.log(a),a.options&&Array.isArray(a.options)){var n=this.utils.select.findDefault(a.options);this.formStateDefaults[a.name]=a.options[n].value;var i=0;a.options.forEach((e=>{if(e.value){var t=o.appendChild(document.createElement("option"));t.setAttribute("value",e.value),t.innerHTML=e.text||e.value,console.log(i,n),i==n&&(t.selected=!0)}i++}))}o.setAttribute("id",`form-${a.name}`),o.addEventListener("change",this.updateFormState(a.name))}})),await window.electronAPI.sizeUp(this.adoptedPrompt.uuid,t.ebox.scrollHeight),console.log(this.formStateDefaults);var a=t.bbox.appendChild(document.createElement("button"));a.addEventListener("click",this.handleCancelButton(this.adoptedPrompt.uuid)),this.adoptedPrompt.cancelButton?(this.adoptedPrompt.cancelButton.classes&&this.adoptedPrompt.cancelButton.classes.forEach((e=>{a.classList.add(e)})),a.innerHTML=this.adoptedPrompt.cancelButton.value?this.adoptedPrompt.cancelButton.value:"Cancel"):a.innerHTML="Cancel",window.addEventListener("keypress",(async e=>{"Enter"===e.key&&(e.preventDefault(),await this.handleButtonClick(this.adoptedPrompt.uuid,"_enter")())})),this.adoptedPrompt.buttons.forEach((e=>{var a=t.bbox.appendChild(document.createElement("button"));a.addEventListener("click",this.handleButtonClick(this.adoptedPrompt.uuid,e.name)),e.classes&&e.classes.forEach((e=>{a.classList.add(e)})),a.innerHTML=e.value}))}else this.logs.log("No prompt to adopt! Need to close...")};utils={select:{findDefault:e=>{var t=0,a=0;return e.forEach((e=>{"selected"in e&&(t=a),a++})),t}}};logs={log:(...e)=>{this.devMode&&console.log(...e)},error:(...e)=>{this.devMode&&console.error(...e)}};handleButtonClick=(e,t)=>async a=>{this.logs.log(e,t);var o={button:t};Object.keys(this.formState).length>0&&(o.values=this.formState),await window.electronAPI.formDone(e,o),window.close()};handleCancel=async()=>{await window.electronAPI.cancel(this.adoptedPrompt.uuid),this.logs.log("cancel time!")};handleCancelButton=()=>async()=>{await this.handleCancel(),window.close()};updateFormState=e=>t=>{const a=document.getElementById(`form-${e}`).value;this.logs.log(e,a),a==this.formStateDefaults[e]?e in this.formState&&delete this.formState[e]:this.formState[e]=a,this.logs.log(this.formState)};updateFormStateFile=e=>t=>{var a=[],o=document.getElementById(`form-${e}`).files;console.log(o),console.log(o.length);for(var s=0;s<o.length;s++)console.log("found a file"),a.push({name:o[s].name,path:o[s].path,size:o[s].size,lastModified:o[s].lastModified});this.logs.log(e,a),0==a.length?e in this.formState&&delete this.formState[e]:this.formState[e]=a,this.logs.log(this.formState)}};window.addEventListener("load",(async()=>{await t.init()}))})();