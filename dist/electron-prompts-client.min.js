(()=>{"use strict";const t={inputHTMLType:{onChange:["number","radio","checkbox","range","file","date","datetime-local","time","week","month","color"],restrictedAttributes:["id","onchange","onkeyup"]}},e=new class{adoptedPrompt=null;devMode=!1;formStateDefaults={};formState={};constructor(){}init=async()=>{const e={ebox:document.getElementById("elemBox"),bbox:document.getElementById("buttonBox"),titleText:document.querySelector(".titleBar span")};if(this.adoptedPrompt=await window.electronAPI.adopt(),this.adoptedPrompt){this.adoptedPrompt.devMode&&(this.devMode=!0),this.logs.log(this.adoptedPrompt,this.adoptedPrompt.windowTitle),e.titleText.innerHTML=this.adoptedPrompt.windowTitle,document.title=this.adoptedPrompt.windowTitle,this.adoptedPrompt.elements.forEach((a=>{switch(a.type){case"header":(o=e.ebox.appendChild(document.createElement("h4"))).innerHTML=a.value,a.classes&&a.classes.forEach((t=>{o.classList.add(t)}));break;case"paragraph":(o=e.ebox.appendChild(document.createElement("p"))).innerHTML=a.value,a.classes&&a.classes.forEach((t=>{o.classList.add(t)}));break;case"input":var o=e.ebox.appendChild(document.createElement("input")),s="keyup";this.formStateDefaults[a.name]=void 0===a.value?"":a.value,console.log(a),"attributes"in a&&("type"in a.attributes&&t.inputHTMLType.onChange.includes(a.attributes.type)&&(s="change"),Object.keys(a.attributes).forEach((e=>{t.inputHTMLType.restrictedAttributes.includes(e)||(!0===a.attributes[e]?o.setAttribute(e,""):o.setAttribute(e,a.attributes[e]))}))),"classes"in a&&a.classes.forEach((t=>{o.classList.add(t)})),"placeholder"in a&&o.setAttribute("placeholder",a.placeholder),"value"in a&&(o.value=a.value),o.setAttribute("id",`form-${a.name}`),"attributes"in a&&"type"in a.attributes&&"file"==a.attributes.type?o.addEventListener(a.updateEvent||s,this.updateFormStateFile(a.name)):o.addEventListener(a.updateEvent||s,this.updateFormState(a.name));break;case"select":if(o=e.ebox.appendChild(document.createElement("select")),a.classes&&a.classes.forEach((t=>{o.classList.add(t)})),console.log(a),a.options&&Array.isArray(a.options)){var n=this.utils.select.findDefault(a.options);this.formStateDefaults[a.name]=a.options[n].value;var i=0;a.options.forEach((t=>{if(t.value){var e=o.appendChild(document.createElement("option"));e.setAttribute("value",t.value),e.innerHTML=t.text||t.value,console.log(i,n),i==n&&(e.selected=!0)}i++}))}o.setAttribute("id",`form-${a.name}`),o.addEventListener("change",this.updateFormState(a.name))}})),await window.electronAPI.sizeUp(this.adoptedPrompt.uuid,e.ebox.scrollHeight),console.log(this.formStateDefaults);var a=e.bbox.appendChild(document.createElement("button"));a.addEventListener("click",this.handleCancelButton(this.adoptedPrompt.uuid)),this.adoptedPrompt.cancelButton?(this.adoptedPrompt.cancelButton.classes&&this.adoptedPrompt.cancelButton.classes.forEach((t=>{a.classList.add(t)})),a.innerHTML=this.adoptedPrompt.cancelButton.value?this.adoptedPrompt.cancelButton.value:"Cancel"):a.innerHTML="Cancel",window.addEventListener("keypress",(async t=>{"Enter"===t.key&&(t.preventDefault(),await this.handleButtonClick(this.adoptedPrompt.uuid,"_enter")())})),this.adoptedPrompt.buttons.forEach((t=>{var a=e.bbox.appendChild(document.createElement("button"));a.addEventListener("click",this.handleButtonClick(this.adoptedPrompt.uuid,t.name)),t.classes&&t.classes.forEach((t=>{a.classList.add(t)})),a.innerHTML=t.value}))}else this.logs.log("No prompt to adopt! Need to close...")};utils={select:{findDefault:t=>{var e=0,a=0;return t.forEach((t=>{"selected"in t&&(e=a),a++})),e}}};logs={log:(...t)=>{this.devMode&&console.log(...t)},error:(...t)=>{this.devMode&&console.error(...t)}};handleButtonClick=(t,e)=>async a=>{this.logs.log(t,e);var o={button:e};Object.keys(this.formState).length>0&&(o.values=this.formState),await window.electronAPI.formDone(t,o),window.close()};handleCancel=async()=>{await window.electronAPI.cancel(this.adoptedPrompt.uuid),this.logs.log("cancel time!")};handleCancelButton=()=>async()=>{await this.handleCancel(),window.close()};updateFormState=t=>e=>{const a=document.getElementById(`form-${t}`).value;this.logs.log(t,a),a==this.formStateDefaults[t]?t in this.formState&&delete this.formState[t]:this.formState[t]=a,this.logs.log(this.formState)};updateFormStateFile=t=>e=>{var a=[],o=document.getElementById(`form-${t}`).files;console.log(o),console.log(o.length);for(var s=0;s<o.length;s++)console.log("found a file"),a.push({name:o[s].name,path:o[s].path,size:o[s].size,lastModified:o[s].lastModified});this.logs.log(t,a),0==a.length?t in this.formState&&delete this.formState[t]:this.formState[t]=a,this.logs.log(this.formState)}};window.addEventListener("load",(async()=>{await e.init()}))})();